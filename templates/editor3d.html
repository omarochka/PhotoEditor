<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" type="image/svg+xml" href="{{ url_for('static', filename='images/favicon3.svg') }}">
    <title>–†–µ–¥–∞–∫—Ç–æ—Ä 3d –≥—Ä–∞—Ñ–∏–∫–∏</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <script src="{{ url_for('static', filename='js/script.js') }}"></script>
   <!-- Three.js –∏ OrbitControls -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.js"></script>
    
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: Arial, sans-serif;
            background: #ffffff;
            color: white;
            height: 100vh;
            overflow: hidden;
        }
        
        .container {
            display: flex;
            height: 100vh;
        }
        
        /* –õ–µ–≤–∞—è –ø–∞–Ω–µ–ª—å - —Å—Ç—Ä–æ–≥–æ –ø–æ –∑–∞–¥–∞–Ω–∏—é */
        .sidebar {
            width: 300px;
            background: #2d2d2d;
            padding: 20px;
            border-right: 2px solid #444;
            overflow-y: auto;
        }
        
        .section {
            background: #333;
            padding: 15px;
            margin-bottom: 20px;
            border-radius: 5px;
        }
        
        h3 {
            color: #3498db;
            margin-bottom: 15px;
            border-bottom: 2px solid #3498db;
            padding-bottom: 5px;
        }
        
        /* –°–æ–∑–¥–∞–Ω–∏–µ —Å—Ü–µ–Ω—ã */
        .scene-controls {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }
        
        .scene-controls input {
            flex: 1;
            padding: 8px;
            background: #444;
            border: 1px solid #555;
            color: white;
            border-radius: 3px;
        }
        
        .scene-controls button {
            background: #3498db;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 3px;
            cursor: pointer;
        }
        
        /* –ü—Ä–∏–º–∏—Ç–∏–≤—ã */
        .primitives {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin-bottom: 15px;
        }
        
        .primitive-btn {
            background: #444;
            border: none;
            color: white;
            padding: 12px;
            border-radius: 5px;
            cursor: pointer;
            transition: background 0.3s;
        }
        
        .primitive-btn:hover {
            background: #555;
        }
        
        /* –°–ø–∏—Å–æ–∫ –æ–±—ä–µ–∫—Ç–æ–≤ */
        .objects-list {
            max-height: 150px;
            overflow-y: auto;
            background: #222;
            padding: 10px;
            border-radius: 5px;
            margin-bottom: 15px;
        }
        
        .object-item {
            padding: 8px;
            background: #444;
            margin-bottom: 5px;
            border-radius: 3px;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
        }
        
        .object-item.selected {
            background: #2980b9;
        }
        
        /* –¢—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏–∏ */
        .transform-controls {
            display: none;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin-bottom: 15px;
        }
        
        .transform-btn {
            background: #444;
            border: none;
            color: white;
            padding: 10px;
            border-radius: 5px;
            cursor: pointer;
        }
        
        .transform-btn.active {
            background: #e74c3c;
        }
        
        /* –°–≤–æ–π—Å—Ç–≤–∞ –æ–±—ä–µ–∫—Ç–∞ */
        .property-group {
            margin-bottom: 10px;
        }
        
        .property-label {
            display: block;
            margin-bottom: 5px;
            color: #aaa;
            font-size: 14px;
        }
        
        .property-input {
            width: 100%;
            padding: 8px;
            background: #444;
            border: 1px solid #555;
            color: white;
            border-radius: 3px;
        }
        
        .coord-inputs {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
        }
        
        /* 3D —Å—Ü–µ–Ω–∞ */
        .scene-area {
            flex: 1;
            position: relative;
            background: #000;
        }
        
        #scene-container {
            width: 100%;
            height: 100%;
        }
        
        .info-bar {
            position: absolute;
            bottom: 10px;
            left: 10px;
            background: rgba(0, 0, 0, 0.7);
            padding: 10px;
            border-radius: 5px;
            font-size: 14px;
        }
    </style>
</head>
<body>

    <!-- –°—Å—ã–ª–∫–∏ –Ω–∞ –¥—Ä—É–≥–∏–µ —Ä–µ–¥–∞–∫—Ç–æ—Ä—ã -->
    <div class="pagesbar">
        <a href="{{ url_for('name') }}">–†–∞—Å—Ç—Ä–æ–≤–∞—è –≥—Ä–∞—Ñ–∏–∫–∞</a>
        <a href="{{ url_for('vector_graphics') }}">–í–µ–∫—Ç–æ—Ä–Ω–∞—è –≥—Ä–∞—Ñ–∏–∫–∞</a>
        <a href="{{ url_for('treeDgraphic') }}">3D –≥—Ä–∞—Ñ–∏–∫–∞</a>
    </div>
    
    <div class="container">
        <!-- –õ–µ–≤–∞—è –ø–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è -->
        <div class="sidebar">
            <!-- 1. –°–æ–∑–¥–∞–Ω–∏–µ —Å—Ü–µ–Ω—ã -->
            <div class="section">
                <h3>üó∫Ô∏è –°–æ–∑–¥–∞–Ω–∏–µ —Å—Ü–µ–Ω—ã</h3>
                <div class="scene-controls">
                    <input type="number" id="scene-size" value="10" min="5" max="50" placeholder="–†–∞–∑–º–µ—Ä">
                    <button onclick="createScene()">–°–æ–∑–¥–∞—Ç—å —Å—Ü–µ–Ω—É</button>
                </div>
                <div class="info-bar" style="position: static; margin-top: 10px;">
                    –†–∞–∑–º–µ—Ä: <span id="current-size">10</span>√ó<span id="current-size2">10</span>√ó<span id="current-size3">10</span>
                </div>
            </div>
            
            <!-- 2. –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–∏–º–∏—Ç–∏–≤–æ–≤ -->
            <div class="section">
                <h3>üî∑ –î–æ–±–∞–≤–∏—Ç—å –æ–±—ä–µ–∫—Ç</h3>
                <div class="primitives">
                    <button class="primitive-btn" onclick="addObject('cube')">–ö—É–±</button>
                    <button class="primitive-btn" onclick="addObject('sphere')">–°—Ñ–µ—Ä–∞</button>
                    <button class="primitive-btn" onclick="addObject('cylinder')">–¶–∏–ª–∏–Ω–¥—Ä</button>
                    <button class="primitive-btn" onclick="addObject('cone')">–ö–æ–Ω—É—Å</button>
                    <button class="primitive-btn" onclick="addObject('torus')">–¢–æ—Ä</button>
                </div>
            </div>
            
            <!-- 3. –°–ø–∏—Å–æ–∫ –æ–±—ä–µ–∫—Ç–æ–≤ -->
            <div class="section">
                <h3>üìã –û–±—ä–µ–∫—Ç—ã —Å—Ü–µ–Ω—ã</h3>
                <div class="objects-list" id="objects-list">
                    <!-- –û–±—ä–µ–∫—Ç—ã –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª—è—Ç—å—Å—è –∑–¥–µ—Å—å -->
                </div>
            </div>
            
            <!-- 4. –¢—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏–∏ -->
            <div class="section">
                <h3>‚öôÔ∏è –¢—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏–∏</h3>
                <div class="transform-controls">
                    <button id="btn-move" class="transform-btn active" onclick="setTransformMode('translate')">–ü–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ</button>
                    <button id="btn-rotate" class="transform-btn" onclick="setTransformMode('rotate')">–í—Ä–∞—â–µ–Ω–∏–µ</button>
                    <button id="btn-scale" class="transform-btn" onclick="setTransformMode('scale')">–ú–∞—Å—à—Ç–∞–±</button>
                </div>
                
                <!-- –ü–æ–∑–∏—Ü–∏—è -->
                <div class="property-group">
                    <label class="property-label">–ü–æ–∑–∏—Ü–∏—è (X, Y, Z):</label>
                    <div class="coord-inputs">
                        <input type="number" id="pos-x" value="0" step="0.1" class="property-input" onchange="updatePosition(0, this.value)">
                        <input type="number" id="pos-y" value="0" step="0.1" class="property-input" onchange="updatePosition(1, this.value)">
                        <input type="number" id="pos-z" value="0" step="0.1" class="property-input" onchange="updatePosition(2, this.value)">
                    </div>
                </div>
                
                <!-- –í—Ä–∞—â–µ–Ω–∏–µ -->
                <div class="property-group">
                    <label class="property-label">–í—Ä–∞—â–µ–Ω–∏–µ (¬∞):</label>
                    <div class="coord-inputs">
                        <input type="number" id="rot-x" value="0" step="1" class="property-input" onchange="updateRotation(0, this.value)">
                        <input type="number" id="rot-y" value="0" step="1" class="property-input" onchange="updateRotation(1, this.value)">
                        <input type="number" id="rot-z" value="0" step="1" class="property-input" onchange="updateRotation(2, this.value)">
                    </div>
                </div>
                
                <!-- –ú–∞—Å—à—Ç–∞–± -->
                <div class="property-group">
                    <label class="property-label">–ú–∞—Å—à—Ç–∞–± (X, Y, Z):</label>
                    <div class="coord-inputs">
                        <input type="number" id="scale-x" value="1" step="0.1" class="property-input" onchange="updateScale(0, this.value)">
                        <input type="number" id="scale-y" value="1" step="0.1" class="property-input" onchange="updateScale(1, this.value)">
                        <input type="number" id="scale-z" value="1" step="0.1" class="property-input" onchange="updateScale(2, this.value)">
                    </div>
                </div>
                
                <!-- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ–±—ä–µ–∫—Ç–æ–º -->
                <div style="display: flex; gap: 10px; margin-top: 15px;">
                    <button onclick="deleteSelectedObject()" style="background: #e74c3c; color: white; border: none; padding: 10px; border-radius: 5px; cursor: pointer; flex: 1;">
                        –£–¥–∞–ª–∏—Ç—å –æ–±—ä–µ–∫—Ç
                    </button>
                </div>
            </div>
        </div>
        
        <!-- 3D —Å—Ü–µ–Ω–∞ -->
        <div class="scene-area">
            <div id="scene-container"></div>
            <div class="info-bar">
                –û–±—ä–µ–∫—Ç–æ–≤: <span id="object-count">0</span> | 
                –†–µ–∂–∏–º: <span id="transform-mode">–ü–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ</span>
            </div>
        </div>
    </div>

    <script>
        // ==================== –ì–õ–û–ë–ê–õ–¨–ù–´–ï –ü–ï–†–ï–ú–ï–ù–ù–´–ï ====================
        let scene, camera, renderer, controls;
        let sceneObjects = [];
        let selectedObject = null;
        let transformMode = 'translate';
        let sceneSize = 10;
        
        // ==================== –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø –°–¶–ï–ù–´ ====================
        function initScene() {
            // 1. –°–æ–∑–¥–∞–µ–º —Å—Ü–µ–Ω—É Three.js
            scene = new THREE.Scene();
            scene.background = new THREE.Color(0x111111);
            
            // 2. –°–æ–∑–¥–∞–µ–º –∫–∞–º–µ—Ä—É
            const container = document.getElementById('scene-container');
            camera = new THREE.PerspectiveCamera(
                75,
                container.clientWidth / container.clientHeight,
                0.1,
                1000
            );
            camera.position.set(15, 10, 15);
            camera.lookAt(0, 0, 0);
            
            // 3. –°–æ–∑–¥–∞–µ–º —Ä–µ–Ω–¥–µ—Ä–µ—Ä
            renderer = new THREE.WebGLRenderer({ antialias: true });
            renderer.setSize(container.clientWidth, container.clientHeight);
            container.appendChild(renderer.domElement);
            
            // 4. –î–æ–±–∞–≤–ª—è–µ–º —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–∞–º–µ—Ä–æ–π
            controls = new THREE.OrbitControls(camera, renderer.domElement);
            controls.enableDamping = true;
            controls.dampingFactor = 0.05;
            
            // 5. –û—Å–≤–µ—â–µ–Ω–∏–µ
            const ambientLight = new THREE.AmbientLight(0xffffff, 0.6);
            scene.add(ambientLight);
            
            const directionalLight = new THREE.DirectionalLight(0xffffff, 0.8);
            directionalLight.position.set(10, 20, 15);
            scene.add(directionalLight);
            
            // 6. –ó–∞–ø—É—Å–∫–∞–µ–º –∞–Ω–∏–º–∞—Ü–∏—é
            animate();
            
            // 7. –°–æ–∑–¥–∞–µ–º —Å—Ü–µ–Ω—É –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
            createScene();
        }
        
        function animate() {
            requestAnimationFrame(animate);
            controls.update();
            renderer.render(scene, camera);
        }
        
        // ==================== 1. –°–û–ó–î–ê–ù–ò–ï –°–¶–ï–ù–´ ====================
        function createScene() {
            sceneSize = parseInt(document.getElementById('scene-size').value) || 10;
            
            // –û—á–∏—â–∞–µ–º —Å—Ü–µ–Ω—É
            scene.children = scene.children.filter(child => 
                !(child instanceof THREE.GridHelper) && 
                !(child instanceof THREE.AxesHelper)
            );
            
            // –û—á–∏—â–∞–µ–º –æ–±—ä–µ–∫—Ç—ã
            sceneObjects.forEach(obj => scene.remove(obj));
            sceneObjects = [];
            selectedObject = null;
            
            // –î–æ–±–∞–≤–ª—è–µ–º —Å–µ—Ç–∫—É –ø–æ —Ä–∞–∑–º–µ—Ä—É —Å—Ü–µ–Ω—ã
            const gridHelper = new THREE.GridHelper(sceneSize * 2, sceneSize * 2, 0x444444, 0x222222);
            scene.add(gridHelper);
            
            // –î–æ–±–∞–≤–ª—è–µ–º –æ—Å–∏ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç
            const axesHelper = new THREE.AxesHelper(sceneSize);
            scene.add(axesHelper);
            
            // –û–±–Ω–æ–≤–ª—è–µ–º UI
            document.getElementById('current-size').textContent = sceneSize;
            document.getElementById('current-size2').textContent = sceneSize;
            document.getElementById('current-size3').textContent = sceneSize;
            updateObjectsList();
            updateInfo();
            
            console.log(`–°–æ–∑–¥–∞–Ω–∞ —Å—Ü–µ–Ω–∞ —Ä–∞–∑–º–µ—Ä–æ–º ${sceneSize}√ó${sceneSize}√ó${sceneSize}`);
        }
        
        // ==================== 2. –î–û–ë–ê–í–õ–ï–ù–ò–ï –û–ë–™–ï–ö–¢–û–í ====================
        function addObject(type) {
            // –°–ª—É—á–∞–π–Ω–∞—è –ø–æ–∑–∏—Ü–∏—è –≤ –ø—Ä–µ–¥–µ–ª–∞—Ö —Å—Ü–µ–Ω—ã
            const position = [
                (Math.random() - 0.5) * sceneSize * 0.8,
                (Math.random() - 0.5) * sceneSize * 0.8,
                (Math.random() - 0.5) * sceneSize * 0.8
            ];
            
            // –°–ª—É—á–∞–π–Ω—ã–π —Ü–≤–µ—Ç
            const colors = ['#3498db', '#2ecc71', '#e74c3c', '#f39c12', '#9b59b6'];
            const color = colors[Math.floor(Math.random() * colors.length)];
            
            // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∑–∞–ø—Ä–æ—Å –Ω–∞ —Å–µ—Ä–≤–µ—Ä –¢–û–õ–¨–ö–û –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –≥–µ–æ–º–µ—Ç—Ä–∏–∏
            fetch('/api/create_object', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    type: type,
                    color: color
                    // –£–ë–†–ê–¢–¨: position, scale, rotation
                })
            })
            .then(response => response.json())
            .then(data => {
                if (data.error) {
                    console.error('–û—à–∏–±–∫–∞:', data.error);
                    return;
                }
                
                // –î–û–ë–ê–í–õ–Ø–ï–ú –ø–æ–∑–∏—Ü–∏—é –∫ –¥–∞–Ω–Ω—ã–º –ø–µ—Ä–µ–¥ —Å–æ–∑–¥–∞–Ω–∏–µ–º –æ–±—ä–µ–∫—Ç–∞
                data.position = position;
                data.scale = [1, 1, 1];
                data.rotation = [0, 0, 0];
                
                createThreeObject(data);
                updateInfo();
                console.log(`–î–æ–±–∞–≤–ª–µ–Ω ${type}`);
            })
            .catch(error => {
                console.error('–û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –æ–±—ä–µ–∫—Ç–∞:', error);
                createSimpleObject(type, position, color);
            });
        }
        
        function createThreeObject(objData) {
            // –°–æ–∑–¥–∞–µ–º –≥–µ–æ–º–µ—Ç—Ä–∏—é –∏–∑ –≤–µ—Ä—à–∏–Ω trimesh
            const geometry = new THREE.BufferGeometry();
            
            // –í–µ—Ä—à–∏–Ω—ã
            const vertices = new Float32Array(objData.vertices.flat());
            geometry.setAttribute('position', new THREE.BufferAttribute(vertices, 3));
            
            // –ì—Ä–∞–Ω–∏
            const indices = new Uint32Array(objData.faces.flat());
            geometry.setIndex(new THREE.BufferAttribute(indices, 1));
            
            // –í—ã—á–∏—Å–ª—è–µ–º –Ω–æ—Ä–º–∞–ª–∏ –¥–ª—è –æ—Å–≤–µ—â–µ–Ω–∏—è
            geometry.computeVertexNormals();
            
            // –ú–∞—Ç–µ—Ä–∏–∞–ª
            const material = new THREE.MeshPhongMaterial({
                color: new THREE.Color(objData.color),
                shininess: 30,
                transparent: true,
                opacity: 0.9
            });
            
            // –°–æ–∑–¥–∞–µ–º –º–µ—à
            const mesh = new THREE.Mesh(geometry, material);
    
            // –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –Ω–∞—á–∞–ª—å–Ω—É—é –ø–æ–∑–∏—Ü–∏—é, –º–∞—Å—à—Ç–∞–± –∏ –≤—Ä–∞—â–µ–Ω–∏–µ
            // –≠—Ç–∏ –¥–∞–Ω–Ω—ã–µ –ø—Ä–∏—Ö–æ–¥—è—Ç —Å –∑–∞–ø—Ä–æ—Å–æ–º, –Ω–æ –Ω–µ –≤ objData
            const initialPosition = [0, 0, 0]; // –∏–ª–∏ —Å–ª—É—á–∞–π–Ω—ã–µ
            const initialScale = [1, 1, 1];
            const initialRotation = [0, 0, 0];
            
            mesh.position.set(...initialPosition);
            mesh.scale.set(...initialScale);
            
            mesh.castShadow = true;
            mesh.receiveShadow = true;
            
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º –¥–∞–Ω–Ω—ã–µ –æ–±—ä–µ–∫—Ç–∞ (–î–û–ë–ê–í–õ–Ø–ï–ú –Ω–∞—á–∞–ª—å–Ω—ã–µ —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏–∏)
            mesh.userData = {
                id: objData.id,
                type: objData.type,
                name: objData.name,
                position: initialPosition,  // –î–æ–±–∞–≤–ª—è–µ–º
                scale: initialScale,        // –î–æ–±–∞–≤–ª—è–µ–º
                rotation: initialRotation,  // –î–æ–±–∞–≤–ª—è–µ–º
                color: objData.color,
                vertices: objData.vertices,
                faces: objData.faces
            };
                    
            // –î–æ–±–∞–≤–ª—è–µ–º –≤ —Å—Ü–µ–Ω—É
            scene.add(mesh);
            sceneObjects.push(mesh);
            
            // –í—ã–±–∏—Ä–∞–µ–º –æ–±—ä–µ–∫—Ç
            selectObject(mesh);
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Å–ø–∏—Å–æ–∫ –æ–±—ä–µ–∫—Ç–æ–≤
            updateObjectsList();
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –ø–æ–ª—è –≤–≤–æ–¥–∞
            updatePropertyFields();
        }
        
        function createSimpleObject(type, position, color) {
            // –ü—Ä–æ—Å—Ç–∞—è —Ä–µ–∑–µ—Ä–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –±–µ–∑ trimesh
            let geometry;
            
            switch(type) {
                case 'cube':
                    geometry = new THREE.BoxGeometry(1, 1, 1);
                    break;
                case 'sphere':
                    geometry = new THREE.SphereGeometry(1, 32, 32);
                    break;
                case 'cylinder':
                    geometry = new THREE.CylinderGeometry(0.5, 0.5, 2, 32);
                    break;
                case 'cone':
                    geometry = new THREE.ConeGeometry(0.5, 2, 32);
                    break;
                case 'torus':
                    geometry = new THREE.TorusGeometry(1, 0.3, 32, 32);
                    break;
                default:
                    geometry = new THREE.BoxGeometry(1, 1, 1);
            }
            
            const material = new THREE.MeshPhongMaterial({
                color: new THREE.Color(color),
                shininess: 30,
                transparent: true,
                opacity: 0.9
            });
            
            const mesh = new THREE.Mesh(geometry, material);
            mesh.position.set(...position);
            
            mesh.userData = {
                id: 'obj_' + Date.now(),
                type: type,
                name: type.charAt(0).toUpperCase() + type.slice(1),
                position: position,
                scale: [1, 1, 1],
                rotation: [0, 0, 0],
                color: color
            };
            
            scene.add(mesh);
            sceneObjects.push(mesh);
            selectObject(mesh);
            updateObjectsList();
            updatePropertyFields();
        }
        
        // ==================== 3. –í–´–ë–û–† –ò –£–ü–†–ê–í–õ–ï–ù–ò–ï –û–ë–™–ï–ö–¢–ê–ú–ò ====================
        function selectObject(object) {
            if (selectedObject) {
                selectedObject.material.emissive.setHex(0x000000);
            }
            
            selectedObject = object;
            if (selectedObject) {
                selectedObject.material.emissive.setHex(0x333333);
                updatePropertyFields();
            }
            
            updateObjectsList();
        }
        
        function deleteSelectedObject() {
            if (!selectedObject) return;
            
            const index = sceneObjects.indexOf(selectedObject);
            if (index !== -1) {
                scene.remove(selectedObject);
                sceneObjects.splice(index, 1);
                selectedObject = null;
                updateObjectsList();
                updateInfo();
                console.log('–û–±—ä–µ–∫—Ç —É–¥–∞–ª–µ–Ω');
            }
        }
        
        // ==================== 4. –¢–†–ê–ù–°–§–û–†–ú–ê–¶–ò–ò ====================
        function updatePosition(axis, value) {
            if (!selectedObject) return;
            
            const newPosition = [...selectedObject.userData.position];
            newPosition[axis] = parseFloat(value) || 0;
            
            // –ü—Ä–∏–º–µ–Ω—è–µ–º —Å—Ä–∞–∑—É –≤ Three.js
            selectedObject.position.set(...newPosition);
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ
            selectedObject.userData.position = newPosition;
            
            // –ú–æ–∂–Ω–æ —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –Ω–∞ —Å–µ—Ä–≤–µ—Ä (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
            saveTransformations();
        }

        function updateRotation(axis, value) {
            if (!selectedObject) return;
            
            const newRotation = [...selectedObject.userData.rotation];
            newRotation[axis] = parseFloat(value) || 0;
            
            // –ü—Ä–∏–º–µ–Ω—è–µ–º —Å—Ä–∞–∑—É –≤ Three.js
            selectedObject.rotation.set(
                THREE.MathUtils.degToRad(newRotation[0]),
                THREE.MathUtils.degToRad(newRotation[1]),
                THREE.MathUtils.degToRad(newRotation[2])
            );
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ
            selectedObject.userData.rotation = newRotation;
            
            // –ú–æ–∂–Ω–æ —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –Ω–∞ —Å–µ—Ä–≤–µ—Ä (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
            saveTransformations();
        }

        function updateScale(axis, value) {
            if (!selectedObject) return;
            
            const newScale = [...selectedObject.userData.scale];
            newScale[axis] = parseFloat(value) || 1;
            
            // –ü—Ä–∏–º–µ–Ω—è–µ–º —Å—Ä–∞–∑—É –≤ Three.js
            selectedObject.scale.set(...newScale);
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ
            selectedObject.userData.scale = newScale;
            
            // –ú–æ–∂–Ω–æ —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –Ω–∞ —Å–µ—Ä–≤–µ—Ä (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
            saveTransformations();
        }

        function saveTransformations() {
            if (!selectedObject) return;
            
            // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –Ω–∞ —Å–µ—Ä–≤–µ—Ä —Ç–æ–ª—å–∫–æ –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è (–Ω–µ –¥–ª—è –ø–µ—Ä–µ—Å—á–µ—Ç–∞)
            fetch('/api/update_object', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    type: selectedObject.userData.type,
                    position: selectedObject.userData.position,
                    scale: selectedObject.userData.scale,
                    rotation: selectedObject.userData.rotation
                })
            }).catch(error => {
                console.error('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è:', error);
            });
        }
            
        
        
        // ==================== –í–°–ü–û–ú–û–ì–ê–¢–ï–õ–¨–ù–´–ï –§–£–ù–ö–¶–ò–ò ====================
        function updateObjectsList() {
            const list = document.getElementById('objects-list');
            list.innerHTML = '';
            
            sceneObjects.forEach((obj, index) => {
                const item = document.createElement('div');
                item.className = `object-item ${obj === selectedObject ? 'selected' : ''}`;
                item.innerHTML = `
                    <span>${obj.userData.name}</span>
                    <span style="color: #aaa; font-size: 12px;">${obj.userData.type}</span>
                `;
                item.onclick = () => selectObject(obj);
                list.appendChild(item);
            });
        }
        
        function updatePropertyFields() {
            if (!selectedObject) {
                // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –ø–æ–ª—è –µ—Å–ª–∏ –Ω–µ—Ç –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ –æ–±—ä–µ–∫—Ç–∞
                ['pos', 'rot', 'scale'].forEach(prefix => {
                    ['x', 'y', 'z'].forEach(axis => {
                        document.getElementById(`${prefix}-${axis}`).value = 
                            prefix === 'scale' ? '1' : '0';
                    });
                });
                return;
            }
            
            // –ó–∞–ø–æ–ª–Ω—è–µ–º –ø–æ–ª—è –¥–∞–Ω–Ω—ã–º–∏ –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ –æ–±—ä–µ–∫—Ç–∞
            const data = selectedObject.userData;
            
            // –ü–æ–∑–∏—Ü–∏—è
            document.getElementById('pos-x').value = data.position[0].toFixed(2);
            document.getElementById('pos-y').value = data.position[1].toFixed(2);
            document.getElementById('pos-z').value = data.position[2].toFixed(2);
            
            // –í—Ä–∞—â–µ–Ω–∏–µ
            document.getElementById('rot-x').value = data.rotation[0].toFixed(1);
            document.getElementById('rot-y').value = data.rotation[1].toFixed(1);
            document.getElementById('rot-z').value = data.rotation[2].toFixed(1);
            
            // –ú–∞—Å—à—Ç–∞–±
            document.getElementById('scale-x').value = data.scale[0].toFixed(2);
            document.getElementById('scale-y').value = data.scale[1].toFixed(2);
            document.getElementById('scale-z').value = data.scale[2].toFixed(2);
        }
        
        function updateInfo() {
            document.getElementById('object-count').textContent = sceneObjects.length;
        }
        
        // ==================== –ó–ê–ü–£–°–ö ====================
        window.addEventListener('DOMContentLoaded', initScene);
        window.addEventListener('resize', function() {
            const container = document.getElementById('scene-container');
            camera.aspect = container.clientWidth / container.clientHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(container.clientWidth, container.clientHeight);
        });
    </script>
    
</body>
</html>